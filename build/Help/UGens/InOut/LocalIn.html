<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<title></title>
<meta name="Generator" content="Cocoa HTML Writer">
<meta name="CocoaVersion" content="824.44">
<style type="text/css">
p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Helvetica}
p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #091fb1; min-height: 12.0px}
p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
p.p5 {margin: 0.0px 0.0px 0.0px 14.0px; text-indent: -14.0px; font: 12.0px Helvetica}
p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #000000}
p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #000000; min-height: 12.0px}
p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #bf0000}
p.p9 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #606060}
span.s1 {font: 18.0px Helvetica}
span.s2 {color: #0000bf}
span.s3 {color: #bf0000}
span.s4 {color: #000000}
span.s5 {color: #606060}
span.Apple-tab-span {white-space:pre}
</style>
</head>
<body>
<p class="p1"><span class="s1"><b>LocalIn</b></span><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>define and read from buses local to a synth</b></p>
<p class="p2"><br></p>
<p class="p3"><b>superclass: AbstractIn</b></p>
<p class="p2"><br></p>
<p class="p3"><b>*ar(numChannels) </b>- define and read from an audio bus local to the enclosing synth.</p>
<p class="p3"><b>*kr(numChannels) </b>-<b> </b>define and read from a control bus local to the enclosing synth.</p>
<p class="p4"><br></p>
<p class="p5"><b>numChannels </b>- the number of channels (i.e. adjacent buses) to read in. The default is 1. You cannot modulate this number by assigning it to an argument in a SynthDef.</p>
<p class="p2"><br></p>
<p class="p3"><b>LocalIn</b> defines buses that are local to the enclosing synth. These are like the global buses, but are more convenient if you want to implement a self contained effect that uses a feedback processing loop.</p>
<p class="p3">There can only be one audio rate and one control rate <b>LocalIn</b> per SynthDef.</p>
<p class="p3">The audio can be written to the bus using <b>LocalOut</b>.</p>
<p class="p4"><br></p>
<p class="p3"><b>N.B.</b> Audio written to a <b>LocalOut</b> will not be read by a corresponding LocalIn until the next cycle, i.e. one block size of samples later. Because of this it is important to take this additional delay into account when using LocalIn to create feedback delays with delay times shorter than the threshold of pitch (i.e. &lt; 0.05 seconds or &gt; 20Hz), or where sample accurate alignment is required. See the resonator example below.</p>
<p class="p4"><br></p>
<p class="p6">(</p>
<p class="p6">{</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="s2">var</span> source, local;</p>
<p class="p7"><span class="Apple-tab-span">	</span></p>
<p class="p6"><span class="Apple-tab-span">	</span>source = <span class="s2">Decay</span>.ar(<span class="s2">Impulse</span>.ar(0.3), 0.1) * <span class="s2">WhiteNoise</span>.ar(0.2);</p>
<p class="p7"><span class="Apple-tab-span">	</span></p>
<p class="p6"><span class="Apple-tab-span">	</span>local = <span class="s2">LocalIn</span>.ar(2) + [source, 0]; <span class="s3">// read feedback, add to source</span></p>
<p class="p7"><span class="Apple-tab-span">	</span></p>
<p class="p6"><span class="Apple-tab-span">	</span>local = <span class="s2">DelayN</span>.ar(local, 0.2, 0.2); <span class="s3">// delay sound</span></p>
<p class="p7"><span class="Apple-tab-span">	</span></p>
<p class="p8"><span class="s4"><span class="Apple-tab-span">	</span></span>// reverse channels to give ping pong effect, apply decay factor</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="s2">LocalOut</span>.ar(local.reverse * 0.8);<span class="Apple-converted-space"> </span></p>
<p class="p7"><span class="Apple-tab-span">	</span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="s2">Out</span>.ar(0, local);</p>
<p class="p6">}.play;</p>
<p class="p6">)</p>
<p class="p7"><br></p>
<p class="p7"><br></p>
<p class="p7"><br></p>
<p class="p6">(</p>
<p class="p6">z = <span class="s2">SynthDef</span>(<span class="s5">"tank"</span>, {</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="s2">var</span> local, in;</p>
<p class="p7"><span class="Apple-tab-span">	</span></p>
<p class="p6"><span class="Apple-tab-span">	</span>in = <span class="s2">Mix</span>.fill(12, {<span class="Apple-converted-space"> </span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s2">Pan2</span>.ar(</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s2">Decay2</span>.ar(<span class="s2">Dust</span>.ar(0.05), 0.1, 0.5, 0.1)<span class="Apple-converted-space"> </span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>* <span class="s2">FSinOsc</span>.ar(<span class="s2">IRand</span>(36,84).midicps).cubed.max(0),<span class="Apple-converted-space"> </span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s2">Rand</span>(-1,1))</p>
<p class="p6"><span class="Apple-tab-span">	</span>});</p>
<p class="p6"><span class="Apple-tab-span">	</span>in = in + <span class="s2">Pan2</span>.ar(<span class="s2">Decay2</span>.ar(<span class="s2">Dust</span>.ar(0.03), 0.04, 0.3) * <span class="s2">BrownNoise</span>.ar, 0);</p>
<p class="p7"><span class="Apple-tab-span">	</span></p>
<p class="p6"><span class="Apple-tab-span">	</span>4.do { in = <span class="s2">AllpassN</span>.ar(in, 0.03, {<span class="s2">Rand</span>(0.005,0.02)}.dup, 1); };</p>
<p class="p7"><span class="Apple-tab-span">	</span></p>
<p class="p6"><span class="Apple-tab-span">	</span>local = <span class="s2">LocalIn</span>.ar(2) * 0.98;</p>
<p class="p6"><span class="Apple-tab-span">	</span>local = <span class="s2">OnePole</span>.ar(local, 0.5);</p>
<p class="p7"><span class="Apple-tab-span">	</span></p>
<p class="p6"><span class="Apple-tab-span">	</span>local = <span class="s2">Rotate2</span>.ar(local[0], local[1], 0.23);</p>
<p class="p6"><span class="Apple-tab-span">	</span>local = <span class="s2">AllpassN</span>.ar(local, 0.05, {<span class="s2">Rand</span>(0.01,0.05)}.dup, 2);</p>
<p class="p7"><span class="Apple-tab-span">	</span><span class="Apple-converted-space"> <span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span></p>
<p class="p6"><span class="Apple-tab-span">	</span>local = <span class="s2">DelayN</span>.ar(local, 0.3, [0.19,0.26]);</p>
<p class="p6"><span class="Apple-tab-span">	</span>local = <span class="s2">AllpassN</span>.ar(local, 0.05, {<span class="s2">Rand</span>(0.03,0.15)}.dup, 2);</p>
<p class="p7"><span class="Apple-tab-span">	</span></p>
<p class="p6"><span class="Apple-tab-span">	</span>local = <span class="s2">LeakDC</span>.ar(local);<span class="Apple-tab-span">	</span></p>
<p class="p6"><span class="Apple-tab-span">	</span>local = local + in;</p>
<p class="p7"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="s2">LocalOut</span>.ar(local);</p>
<p class="p7"><span class="Apple-tab-span">	</span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="s2">Out</span>.ar(0, local);</p>
<p class="p6">}).play;</p>
<p class="p6">)</p>
<p class="p7"><br></p>
<p class="p7"><br></p>
<p class="p7"><br></p>
<p class="p6">(</p>
<p class="p6">z = <span class="s2">SynthDef</span>(<span class="s5">"tape"</span>, {</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="s2">var</span> local, in, amp;</p>
<p class="p7"><span class="Apple-tab-span">	</span></p>
<p class="p6"><span class="Apple-tab-span">	</span>in = <span class="s2">SoundIn</span>.ar([0,1]);</p>
<p class="p7"><span class="Apple-tab-span">	</span></p>
<p class="p6"><span class="Apple-tab-span">	</span>amp = <span class="s2">Amplitude</span>.kr(<span class="s2">Mix</span>.ar(in));</p>
<p class="p6"><span class="Apple-tab-span">	</span>in = in * (amp &gt; 0.02); <span class="s3">// noise gate</span></p>
<p class="p7"><span class="Apple-tab-span">	</span></p>
<p class="p6"><span class="Apple-tab-span">	</span>local = <span class="s2">LocalIn</span>.ar(2);</p>
<p class="p6"><span class="Apple-tab-span">	</span>local = <span class="s2">OnePole</span>.ar(local, 0.4);</p>
<p class="p6"><span class="Apple-tab-span">	</span>local = <span class="s2">OnePole</span>.ar(local, -0.08);</p>
<p class="p7"><span class="Apple-tab-span">	</span></p>
<p class="p6"><span class="Apple-tab-span">	</span>local = <span class="s2">Rotate2</span>.ar(local[0], local[1], 0.2);</p>
<p class="p7"><span class="Apple-tab-span">	</span><span class="Apple-converted-space"> <span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span></p>
<p class="p6"><span class="Apple-tab-span">	</span>local = <span class="s2">DelayN</span>.ar(local, 0.25, 0.25);</p>
<p class="p7"><span class="Apple-tab-span">	</span></p>
<p class="p6"><span class="Apple-tab-span">	</span>local = <span class="s2">LeakDC</span>.ar(local);<span class="Apple-tab-span">	</span></p>
<p class="p6"><span class="Apple-tab-span">	</span>local = ((local + in) * 1.25).softclip;</p>
<p class="p7"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="s2">LocalOut</span>.ar(local);</p>
<p class="p7"><span class="Apple-tab-span">	</span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="s2">Out</span>.ar(0, local * 0.1);</p>
<p class="p6">}).play;</p>
<p class="p6">)</p>
<p class="p7"><br></p>
<p class="p8">// Resonator, must subtract blockSize for correct tuning</p>
<p class="p6">(</p>
<p class="p6"><span class="s2">var</span> play, imp, initial;</p>
<p class="p9"><span class="s2">SynthDef</span><span class="s4">(</span>"testRes"<span class="s4">, {</span></p>
<p class="p7"><br></p>
<p class="p6">play = <span class="s2">LocalIn</span>.ar(1);<span class="Apple-converted-space"> </span></p>
<p class="p6">imp = <span class="s2">Impulse</span>.ar(1);</p>
<p class="p7"><br></p>
<p class="p6"><span class="s2">LocalOut</span>.ar(<span class="s2">DelayC</span>.ar(imp + (play * 0.995), 1, 440.reciprocal - <span class="s2">ControlRate</span>.ir.reciprocal)); <span class="s3">// for feedback</span></p>
<p class="p7"><br></p>
<p class="p6"><span class="s2">OffsetOut</span>.ar(0, play);</p>
<p class="p7"><br></p>
<p class="p6">}).play(s);</p>
<p class="p7"><br></p>
<p class="p6">{<span class="s2">SinOsc</span>.ar(440, 0, 0.2) }.play(s, 1); <span class="s3">// compare pitch</span></p>
<p class="p6">)</p>
</body>
</html>
