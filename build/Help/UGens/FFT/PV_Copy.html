<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<title></title>
<meta name="Generator" content="Cocoa HTML Writer">
<meta name="CocoaVersion" content="824.44">
<style type="text/css">
p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px Helvetica}
p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; color: #0016e6}
p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco}
p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #606060}
p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; min-height: 12.0px}
p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #902a19}
span.s1 {color: #000000}
span.s2 {text-decoration: underline}
span.s3 {color: #091fb1}
span.s4 {color: #456c20}
span.s5 {color: #902a19}
span.Apple-tab-span {white-space:pre}
</style>
</head>
<body>
<p class="p1"><b>PV_Copy<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>copy an FFT buffer</b></p>
<p class="p2"><br></p>
<p class="p3"><b>PV_Copy(bufferA,<span class="Apple-converted-space">  </span>bufferB)</b></p>
<p class="p2"><br></p>
<p class="p3">Copies the spectral frame in bufferA to bufferB at that point in the chain of PV UGens. This allows for parallel processing of spectral data without the need for multiple FFT UGens, and to copy out data at that point in the chain for other purposes. bufferA and bufferB must be the same size.</p>
<p class="p3"><b>bufferA</b> - source buffer.</p>
<p class="p3"><b>bufferB</b> - destination buffer.</p>
<p class="p2"><br></p>
<p class="p4"><span class="s1">See also <a href="FFT Overview.html"><span class="s2">FFT Overview</span></a>.</span></p>
<p class="p2"><br></p>
<p class="p5">s.boot;</p>
<p class="p5">(</p>
<p class="p5">b = <span class="s3">Buffer</span>.alloc(s,2048,1);</p>
<p class="p5">c = <span class="s3">Buffer</span>.alloc(s,2048,1);</p>
<p class="p6"><span class="s1">d = </span><span class="s3">Buffer</span><span class="s1">.read(s,</span>"sounds/a11wlk01.wav"<span class="s1">);</span></p>
<p class="p5">e = <span class="s3">Buffer</span>.alloc(s,2048,1);</p>
<p class="p5">f = <span class="s3">Buffer</span>.alloc(s,2048,1);</p>
<p class="p5">)</p>
<p class="p7"><br></p>
<p class="p8">//// proof of concept</p>
<p class="p5">(</p>
<p class="p5">x = { <span class="s3">var</span> inA, chainA, inB, chainB, chain;</p>
<p class="p5"><span class="Apple-tab-span">	</span>inA = <span class="s3">LFClipNoise</span>.ar(100);</p>
<p class="p5"><span class="Apple-tab-span">	</span>chainA = <span class="s3">FFT</span>(b, inA);</p>
<p class="p5"><span class="Apple-tab-span">	</span>chainB = <span class="s3">PV_Copy</span>(chainA, c); <span class="Apple-converted-space"> </span></p>
<p class="p8"><span class="s1"><span class="Apple-tab-span">	</span></span><span class="s3">IFFT</span><span class="s1">(chainA) - </span><span class="s3">IFFT</span><span class="s1">(chainB); </span>// cancels to zero so silent!</p>
<p class="p5">}.play(s);</p>
<p class="p5">)</p>
<p class="p5">x.free;</p>
<p class="p8">// IFFTed frames contain the same windowed output data</p>
<p class="p5">b.plot(<span class="s4">\b</span>, <span class="s3">Rect</span>(200, 430, 700, 300)); c.plot(<span class="s4">\c</span>, <span class="s3">Rect</span>(200, 100, 700, 300));</p>
<p class="p7"><br></p>
<p class="p7"><br></p>
<p class="p8">//// crossfade between original and magmul-ed whitenoise</p>
<p class="p5">(</p>
<p class="p5">x = { <span class="s3">var</span> in, in2, chain, chainB, chainC;</p>
<p class="p5"><span class="Apple-tab-span">	</span>in = <span class="s3">PlayBuf</span>.ar(1, d, <span class="s3">BufRateScale</span>.kr(d), loop: 1);</p>
<p class="p5"><span class="Apple-tab-span">	</span>in2 = <span class="s3">WhiteNoise</span>.ar;</p>
<p class="p5"><span class="Apple-tab-span">	</span>chain = <span class="s3">FFT</span>(b, in);</p>
<p class="p5"><span class="Apple-tab-span">	</span>chainB = <span class="s3">FFT</span>(c, in2);</p>
<p class="p5"><span class="Apple-tab-span">	</span>chainC = <span class="s3">PV_Copy</span>(chain, e);</p>
<p class="p5"><span class="Apple-tab-span">	</span>chainB = <span class="s3">PV_MagMul</span>(chainB, chainC);</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="s3">XFade2</span>.ar(<span class="s3">IFFT</span>(chain), <span class="s3">IFFT</span>(chainB) * 0.1, <span class="s3">SinOsc</span>.kr(0.1, 1.5pi), 0.25);</p>
<p class="p5">}.play(s);</p>
<p class="p5">)</p>
<p class="p5">x.free;</p>
<p class="p7"><br></p>
<p class="p7"><br></p>
<p class="p8">//// as previous but with Blip for 'vocoder' cross synthesis effect</p>
<p class="p5">(</p>
<p class="p5">x = { <span class="s3">var</span> in, in2, chain, chainB, chainC;</p>
<p class="p5"><span class="Apple-tab-span">	</span>in = <span class="s3">PlayBuf</span>.ar(1, d, <span class="s3">BufRateScale</span>.kr(d), loop: 1);</p>
<p class="p5"><span class="Apple-tab-span">	</span>in2 = <span class="s3">Blip</span>.ar(100, 50);</p>
<p class="p5"><span class="Apple-tab-span">	</span>chain = <span class="s3">FFT</span>(b, in);</p>
<p class="p5"><span class="Apple-tab-span">	</span>chainB = <span class="s3">FFT</span>(c, in2);</p>
<p class="p5"><span class="Apple-tab-span">	</span>chainC = <span class="s3">PV_Copy</span>(chain, e);</p>
<p class="p5"><span class="Apple-tab-span">	</span>chainB = <span class="s3">PV_MagMul</span>(chainB, chainC);</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="s3">XFade2</span>.ar(<span class="s3">IFFT</span>(chain), <span class="s3">IFFT</span>(chainB) * 0.1, <span class="s3">SinOsc</span>.ar(0.1), 0.25);</p>
<p class="p5">}.play(s);</p>
<p class="p5">)</p>
<p class="p5">x.free;</p>
<p class="p7"><br></p>
<p class="p7"><br></p>
<p class="p8">//// Spectral 'pan'</p>
<p class="p5">(</p>
<p class="p5">x = { <span class="s3">var</span> in, chain, chainB, pan;</p>
<p class="p5"><span class="Apple-tab-span">	</span>in = <span class="s3">PlayBuf</span>.ar(1, d, <span class="s3">BufRateScale</span>.kr(d), loop: 1);</p>
<p class="p5"><span class="Apple-tab-span">	</span>chain = <span class="s3">FFT</span>(b, in);</p>
<p class="p5"><span class="Apple-tab-span">	</span>chainB = <span class="s3">PV_Copy</span>(chain, c);</p>
<p class="p5"><span class="Apple-tab-span">	</span>pan = <span class="s3">MouseX</span>.kr(0.001, 1.001, <span class="s4">'exponential'</span>) - 0.001;</p>
<p class="p5"><span class="Apple-tab-span">	</span>chain = <span class="s3">PV_BrickWall</span>(chain, pan);<span class="Apple-converted-space"> </span></p>
<p class="p5"><span class="Apple-tab-span">	</span>chainB = <span class="s3">PV_BrickWall</span>(chainB, -1 + pan); <span class="Apple-converted-space"> </span></p>
<p class="p5"><span class="Apple-tab-span">	</span>0.5 * <span class="s3">IFFT</span>([chain, chainB]);</p>
<p class="p5">}.play(s);</p>
<p class="p5">)</p>
<p class="p5">x.free;</p>
<p class="p7"><br></p>
<p class="p7"><br></p>
<p class="p8">//// Multiple Magnitude plots</p>
<p class="p5">(</p>
<p class="p5">x = { <span class="s3">var</span> in, chain, chainB, chainC;</p>
<p class="p5"><span class="Apple-tab-span">	</span>in = <span class="s3">WhiteNoise</span>.ar;</p>
<p class="p5"><span class="Apple-tab-span">	</span>chain = <span class="s3">FFT</span>(b, in);</p>
<p class="p8"><span class="s1"><span class="Apple-tab-span">	</span></span><span class="s3">PV_Copy</span><span class="s1">(chain, c); </span>// initial spectrum</p>
<p class="p5"><span class="Apple-tab-span">	</span>chain = <span class="s3">PV_RectComb</span>(chain, 20, 0, 0.2);</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="s3">PV_Copy</span>(chain, e); <span class="s5">// after comb</span></p>
<p class="p5"><span class="Apple-tab-span">	</span>2.do({chain = <span class="s3">PV_MagSquared</span>(chain)});<span class="Apple-converted-space"> </span></p>
<p class="p8"><span class="s1"><span class="Apple-tab-span">	</span></span><span class="s3">PV_Copy</span><span class="s1">(chain, f); </span>// after magsquared</p>
<p class="p5"><span class="Apple-tab-span">	</span>0.00001 * Pan2.ar(<span class="s3">IFFT</span>(chain));</p>
<p class="p5">}.play(s);</p>
<p class="p5">)</p>
<p class="p5">x.free;</p>
<p class="p7"><br></p>
<p class="p5">(</p>
<p class="p5">c.getToFloatArray(action: { <span class="s3">arg</span> array;</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="s3">var</span> z, x;</p>
<p class="p5"><span class="Apple-tab-span">	</span>z = array.clump(2).flop;</p>
<p class="p8"><span class="s1"><span class="Apple-tab-span">	</span></span>// Initially data is in complex form</p>
<p class="p5"><span class="Apple-tab-span">	</span>z = [<span class="s3">Signal</span>.newFrom(z[0]), <span class="s3">Signal</span>.newFrom(z[1])];</p>
<p class="p5"><span class="Apple-tab-span">	</span>x = <span class="s3">Complex</span>(z[0], z[1]);</p>
<p class="p5"><span class="Apple-tab-span">	</span>{x.magnitude.plot(<span class="s4">'Initial'</span>, <span class="s3">Rect</span>(200, 560, 700, 200))}.defer</p>
<p class="p5">});</p>
<p class="p5">e.getToFloatArray(action: { <span class="s3">arg</span> array;</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="s3">var</span> z, x;</p>
<p class="p5"><span class="Apple-tab-span">	</span>z = array.clump(2).flop;</p>
<p class="p8"><span class="s1"><span class="Apple-tab-span">	</span></span>// RectComb doesn't convert, so it's still complex</p>
<p class="p5"><span class="Apple-tab-span">	</span>z = [<span class="s3">Signal</span>.newFrom(z[0]), <span class="s3">Signal</span>.newFrom(z[1])];</p>
<p class="p5"><span class="Apple-tab-span">	</span>x = <span class="s3">Complex</span>(z[0], z[1]);</p>
<p class="p5"><span class="Apple-tab-span">	</span>{x.magnitude.plot(<span class="s4">'After RectComb'</span>, <span class="s3">Rect</span>(200, 330, 700, 200))}.defer</p>
<p class="p5">});</p>
<p class="p5">f.getToFloatArray(action: { <span class="s3">arg</span> array;</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="s3">var</span> z, x;</p>
<p class="p5"><span class="Apple-tab-span">	</span>z = array.clump(2).flop;</p>
<p class="p8"><span class="s1"><span class="Apple-tab-span">	</span></span>// MagSquared converts to Polar</p>
<p class="p5"><span class="Apple-tab-span">	</span>x = <span class="s3">Signal</span>.newFrom(z[0]); <span class="s5">// magnitude first</span></p>
<p class="p5"><span class="Apple-tab-span">	</span>{x.plot(<span class="s4">'After MagSquared'</span>, <span class="s3">Rect</span>(200, 100, 700, 200))}.defer</p>
<p class="p5">})</p>
<p class="p5">)</p>
<p class="p7"><br></p>
<p class="p5">[b, c, d, e, f].do(<span class="s3">_</span>.free); <span class="s5">// free the buffers</span></p>
</body>
</html>
