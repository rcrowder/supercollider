<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<title></title>
<meta name="Generator" content="Cocoa HTML Writer">
<meta name="CocoaVersion" content="824.44">
<style type="text/css">
p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px Helvetica}
p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; min-height: 12.0px}
p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 10.0px Monaco; color: #1632ed}
p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco}
p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #902a19}
span.s1 {color: #496931}
span.s2 {text-decoration: underline}
span.s3 {color: #091fb1}
span.s4 {color: #000000}
span.Apple-tab-span {white-space:pre}
</style>
</head>
<body>
<p class="p1"><b>Convolution<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>real-time convolver</b></p>
<p class="p2"><br></p>
<p class="p3"><b>Convolution.ar(in, kernel, framesize, mul, add)</b></p>
<p class="p2"><br></p>
<p class="p3">Strict convolution of two continuously changing inputs. Also see [Convolution2] for a cheaper CPU cost alternative for the case of a fixed kernel which can be changed with a trigger message.<span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p5"><span class="s1">//see ch18 </span><span class="s2">http://www.dspguide.com/ch18.htm</span><span class="s1"> Steven W Smith</span></p>
<p class="p4"><br></p>
<p class="p3"><b>in</b> - processing target</p>
<p class="p3"><b>kernel</b> - processing kernel.<span class="Apple-converted-space"> </span></p>
<p class="p3"><b>framesize</b>- size of FFT frame, must be a power of two</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p6">(</p>
<p class="p2"><br></p>
<p class="p6"><span class="Apple-tab-span">	</span>{ <span class="s3">var</span> input, kernel;</p>
<p class="p2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p6"><span class="Apple-tab-span">	</span>input=<span class="s3">AudioIn</span>.ar(1);<span class="Apple-tab-span">	</span></p>
<p class="p6"><span class="Apple-tab-span">	</span>kernel= <span class="s3">Mix</span>.ar(<span class="s3">LFSaw</span>.ar([300,500,800,1000]*<span class="s3">MouseX</span>.kr(1.0,2.0),0,1.0));</p>
<p class="p2"><br></p>
<p class="p7"><span class="s4"><span class="Apple-tab-span">	</span></span>//must have power of two framesize</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="s3">Out</span>.ar(0,<span class="s3">Convolution</span>.ar(input,kernel, 1024, 0.5));</p>
<p class="p6"><span class="Apple-tab-span">	</span> }.play;</p>
<p class="p2"><br></p>
<p class="p6">)</p>
<p class="p2"><br></p>
<p class="p6">(</p>
<p class="p7">//must have power of two framesize- FFT size will be sorted by Convolution to be double this</p>
<p class="p7">//maximum is currently a=8192 for FFT of size 16384</p>
<p class="p6">a=2048;</p>
<p class="p6">s = <span class="s3">Server</span>.local;<span class="Apple-converted-space"> </span></p>
<p class="p7">//kernel buffer</p>
<p class="p6">g = <span class="s3">Buffer</span>.alloc(s,a,1);</p>
<p class="p6">)</p>
<p class="p2"><br></p>
<p class="p6">(</p>
<p class="p7">//random impulse response</p>
<p class="p6">g.set(0,1.0);</p>
<p class="p6">100.do({<span class="s3">arg</span> i; g.set(a.rand, 1.0.rand)});</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p6"><span class="Apple-tab-span">	</span>{ <span class="s3">var</span> input, kernel;</p>
<p class="p2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p6"><span class="Apple-tab-span">	</span>input=<span class="s3">AudioIn</span>.ar(1);<span class="Apple-tab-span">	</span></p>
<p class="p6"><span class="Apple-tab-span">	</span>kernel= <span class="s3">PlayBuf</span>.ar(1,g,<span class="s3">BufRateScale</span>.kr(g),1,0,1);</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="s3">Out</span>.ar(0,<span class="s3">Convolution</span>.ar(input,kernel, 2*a, 0.5));</p>
<p class="p6"><span class="Apple-tab-span">	</span> }.play;</p>
<p class="p2"><br></p>
<p class="p6">)</p>
</body>
</html>
