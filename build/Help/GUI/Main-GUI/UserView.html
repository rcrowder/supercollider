<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<title></title>
<meta name="Generator" content="Cocoa HTML Writer">
<meta name="CocoaVersion" content="824.48">
<style type="text/css">
p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; min-height: 12.0px}
p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; color: #001fe8}
p.p5 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 12.0px Helvetica; min-height: 14.0px}
p.p6 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 14.0px Helvetica}
p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 16.0px Times; min-height: 19.0px}
p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Helvetica}
p.p9 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 9.0px Monaco; min-height: 12.0px}
p.p10 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 12.0px Helvetica}
p.p11 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 14.0px Helvetica; min-height: 17.0px}
p.p12 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #ad1d13}
p.p13 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco}
p.p14 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #000000}
p.p15 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #000000; min-height: 12.0px}
p.p16 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #bf0000}
p.p17 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #606060}
span.s1 {font: 18.0px Helvetica}
span.s2 {color: #2347da}
span.s3 {color: #000000}
span.s4 {text-decoration: underline}
span.s5 {text-decoration: underline ; color: #001fe8}
span.s6 {color: #1940e0}
span.s7 {color: #002ff0}
span.s8 {color: #0019ba}
span.s9 {color: #0000bf}
span.s10 {color: #007300}
span.s11 {color: #2b6f11}
span.s12 {color: #606060}
span.Apple-tab-span {white-space:pre}
</style>
</head>
<body>
<p class="p1"><span class="s1"><b>UserView<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b></span><b>a cross-platform redirector for a GUI widget</b><span class="s1"><b><span class="Apple-tab-span">	</span></b></span></p>
<p class="p2"><br></p>
<p class="p1"><b>Inherits from: </b><a href="../../Core/Object.html"><span class="s2"><b>Object</b></span></a><b> : </b><a href="../GUI-Tools/ViewRedirect.html"><span class="s2"><b>ViewRedirect</b></span></a></p>
<p class="p3"><br></p>
<p class="p1">This class will return the gui kit specific version of a UserView.</p>
<p class="p2"><br></p>
<p class="p4"><span class="s3"><b>See also:</b> <a href="../GUI-Tools/GUI.html"><span class="s4">GUI</span></a>, <a href="../GUI-Classes.html"><span class="s4">GUI-Classes</span></a>, <a href="../GUI-Overview.html"><span class="s4">GUI-Overview</span></a></span></p>
<p class="p5"><br></p>
<p class="p6"><b>Platform Specific Examples and Documentation:</b></p>
<p class="p7"><br></p>
<p class="p1"><b>SwingGUI:<span class="Apple-converted-space">     </span></b> <a href="../../SwingOSC/JSCUserView.html"><span class="s5">JSCUserView</span></a></p>
<p class="p7"><br></p>
<p class="p1"><b>CocoaGUI:<span class="Apple-converted-space">     </span></b> <a href="../Cocoa-GUI/SCUserView.html"><span class="s5">SCUserView</span></a></p>
<p class="p7"><br></p>
<p class="p1">Some of the links above might not work, if the help files for the listed kit are not included in your setup. If you do not see your GUI kit listed in the help redirect stubs, or to fix the above links,<span class="Apple-converted-space">  </span>see <a href="../GUI-Tools/Regenerate-GUI-Help.html"><span class="s6">Regenerate-GUI-Help</span></a>.</p>
<p class="p3"><br></p>
<p class="p8"><b>Creation / Class Methods</b></p>
<p class="p9"><br></p>
<p class="p10"><b><span class="Apple-tab-span">	</span>*new (parent, bounds)</b></p>
<p class="p5"><br></p>
<p class="p6"><b>Examples</b></p>
<p class="p11"><br></p>
<p class="p10"><span class="s5"><a href="../GUI-Overview.html">GUI-Overview</a></span> contains an elobarate example on how to make a gui widget with UserView using interface level coding. For a Tutorial on how to write a subclass of SCUserView to make your own custom GUI Widgets, see <a href="../Cocoa-GUI/SCUserViewSubclassing/SCUserView-Subclassing.html"><span class="s7">SCUserView-Subclassing</span></a></p>
<p class="p11"><br></p>
<p class="p12">// Basic Usage. Resize the window to refresh the drawing. Or use mouse click.</p>
<p class="p3"><br></p>
<p class="p13">(</p>
<p class="p13">w=<span class="s8">Window</span>.new;</p>
<p class="p13">v=<span class="s8">UserView</span>(w, w.view.bounds.insetBy(50,50));</p>
<p class="p13">v.background_(<span class="s8">Color</span>.rand);</p>
<p class="p13">v.relativeOrigin=<span class="s8">true</span>;</p>
<p class="p13">v.drawFunc={<span class="s8">|uview|</span></p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s8">Pen</span>.moveTo(0@uview.bounds.height.rand);</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s8">Pen</span>.lineTo(uview.bounds.width@uview.bounds.height.rand);</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s8">Pen</span>.stroke;</p>
<p class="p13"><span class="Apple-tab-span">	</span>};</p>
<p class="p13">v.mouseDownAction={v.refresh};</p>
<p class="p13">w.front;</p>
<p class="p3"><br></p>
<p class="p13">)</p>
<p class="p3"><br></p>
<p class="p3"><br></p>
<p class="p3"><br></p>
<p class="p12">// A More complicated drawing function.</p>
<p class="p12">// Resize the window to refresh the drawing</p>
<p class="p13">(</p>
<p class="p14"><span class="s9">var</span> func;</p>
<p class="p15"><br></p>
<p class="p14">func = {<span class="s9">|me|</span></p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="s9">Pen</span>.use{</p>
<p class="p16"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// clipping into the boundingbox</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">Pen</span>.moveTo((me.bounds.left)@(me.bounds.top));</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">Pen</span>.lineTo(((me.bounds.left)@(me.bounds.top))</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>+ (me.bounds.width@0));</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">Pen</span>.lineTo(((me.bounds.left)@(me.bounds.top))</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>+ (me.bounds.width@me.bounds.height));</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">Pen</span>.lineTo(((me.bounds.left)@(me.bounds.top))</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>+ (0@me.bounds.height));</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">Pen</span>.lineTo((me.bounds.left)@(me.bounds.top));</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">Pen</span>.clip;</p>
<p class="p15"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p16"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// draw background</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">Pen</span>.fillColor = <span class="s9">Color</span>.gray(0.5);</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">Pen</span>.moveTo((me.bounds.left)@(me.bounds.top));</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">Pen</span>.lineTo(((me.bounds.left)@(me.bounds.top))</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>+ (me.bounds.width@0));</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">Pen</span>.lineTo(((me.bounds.left)@(me.bounds.top))</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>+ (me.bounds.width@me.bounds.height));</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">Pen</span>.lineTo(((me.bounds.left)@(me.bounds.top))</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>+ (0@me.bounds.height));</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">Pen</span>.lineTo((me.bounds.left)@(me.bounds.top));</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">Pen</span>.fill;<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p15"><br></p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">Pen</span>.translate(100, 100);</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>10.do{</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">Pen</span>.color = <span class="s9">Color</span>.red(rrand(0.0, 1), rrand(0.0, 0.5));</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">Pen</span>.addArc((400.exprand(2))@(100.rand), rrand(10, 100), 2pi.rand, pi);</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">Pen</span>.perform([<span class="s10">\stroke</span>, <span class="s10">\fill</span>].choose);</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>}</p>
<p class="p14"><span class="Apple-tab-span">	</span>}</p>
<p class="p14">};</p>
<p class="p15"><br></p>
<p class="p17"><span class="s3">w = </span><span class="s9">Window</span><span class="s3">.new(</span>"DrawFunc Examples"<span class="s3">).front;</span></p>
<p class="p14">w.view.background_(<span class="s9">Color</span>.white);</p>
<p class="p14">3.do{<span class="s9">|i|</span></p>
<p class="p14"><span class="Apple-tab-span">	</span>v = <span class="s9">UserView</span>(w, <span class="s9">Rect</span>(20+(i*120), 100, 100, 100));</p>
<p class="p14"><span class="Apple-tab-span">	</span>v.drawFunc = func;</p>
<p class="p14">};</p>
<p class="p14">w.refresh;</p>
<p class="p13">)</p>
<p class="p3"><br></p>
<p class="p3"><br></p>
<p class="p12">// Use Relative Coordinates</p>
<p class="p12">// Set the Origin of Pen in the view's drawFunc relative to the UserView.</p>
<p class="p12">// This is particularly useful if resize is set in such a way the the position of the user view changes.</p>
<p class="p12">// Try resizing the Window.</p>
<p class="p3"><br></p>
<p class="p13">(</p>
<p class="p14"><span class="s9">var</span> func;</p>
<p class="p15"><br></p>
<p class="p14">func = {<span class="s9">|me|</span></p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="s9">Pen</span>.use{</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>10.do{</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">Pen</span>.color = <span class="s9">Color</span>.red(rrand(0.0, 1), rrand(0.0, 0.5));</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">Pen</span>.addArc((400.exprand(2))@(100.rand), rrand(10, 100), 2pi.rand, pi);</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">Pen</span>.perform([<span class="s10">\stroke</span>, <span class="s10">\fill</span>].choose);</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>}</p>
<p class="p14"><span class="Apple-tab-span">	</span>}</p>
<p class="p14">};</p>
<p class="p15"><br></p>
<p class="p17"><span class="s3">w = </span><span class="s9">Window</span><span class="s3">.new(</span>"DrawFunc Examples"<span class="s3">).front;</span></p>
<p class="p14">w.view.background_(<span class="s9">Color</span>.white);</p>
<p class="p15"><br></p>
<p class="p14">3.do{<span class="s9">|i|</span></p>
<p class="p14"><span class="Apple-tab-span">	</span>v = <span class="s9">UserView</span>(w, <span class="s9">Rect</span>(20+(i*120), 100, 100, 100))</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>.drawFunc_(func).relativeOrigin_(<span class="s9">true</span>);</p>
<p class="p16"><span class="s3"><span class="Apple-tab-span">	</span>v.resize=3; </span>// the func coordinates are valid even though the view move on resize</p>
<p class="p14"><span class="Apple-tab-span">	</span>v.background_(<span class="s9">Color</span>.rand);</p>
<p class="p14">};</p>
<p class="p15"><br></p>
<p class="p14">w.refresh;</p>
<p class="p13">)</p>
<p class="p3"><br></p>
<p class="p3"><br></p>
<p class="p12">// Mouse Tracking</p>
<p class="p12">// Set the function which should be evaluated if the mouse is at the end of tracking (mouse-up).</p>
<p class="p12">// This function will be passed four arguments: theView, x coordinate, y coordinate, and keyboard modifiers.</p>
<p class="p3"><span class="Apple-tab-span">	</span></p>
<p class="p13">(</p>
<p class="p13"><span class="s8">var</span> drawFunc, mouseDownFunc, mouseUpFunc, mouseMoveFunc, sat = 0, absX;</p>
<p class="p3"><br></p>
<p class="p13">drawFunc = {<span class="s8">|me|</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s8">Pen</span>.use{</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>10.do{</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Pen.color = <span class="s8">Color</span>.red(rrand(0.0, 1), rrand(0.0, 0.5));</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s8">Pen</span>.addArc((400.exprand(2))@(100.rand), rrand(10, 100), 2pi.rand, pi);</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s8">Pen</span>.perform([<span class="s11">\stroke</span>, <span class="s11">\fill</span>].choose);</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>}</p>
<p class="p13"><span class="Apple-tab-span">	</span>}</p>
<p class="p13">};</p>
<p class="p3"><br></p>
<p class="p13">mouseDownFunc = {<span class="s8">|me, x, y, mod|</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>absX = x;</p>
<p class="p17"><span class="s3"><span class="Apple-tab-span">	</span>postf(</span>"begin path: x=% realtive mousePosition:%\n"<span class="s3">,absX, me.mousePosition);</span></p>
<p class="p13">};</p>
<p class="p3"><br></p>
<p class="p13">mouseUpFunc = {<span class="s8">|me, x, y, mod|</span></p>
<p class="p17"><span class="s3"><span class="Apple-tab-span">	</span>postf(</span>"end path: (absX-x)==% realtive mousePosition:%\n"<span class="s3">,(absX-x), me.mousePosition);</span></p>
<p class="p3"><span class="Apple-tab-span">	</span></p>
<p class="p13">};</p>
<p class="p3"><br></p>
<p class="p13">mouseMoveFunc = {<span class="s8">|me, x, y, mod|</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>sat = ((absX-x)/100);</p>
<p class="p13"><span class="Apple-tab-span">	</span>((me.mousePosition)/(me.bounds.width@me.bounds.height)).postln;</p>
<p class="p13"><span class="Apple-tab-span">	</span>me.refresh;</p>
<p class="p13">};</p>
<p class="p3"><br></p>
<p class="p13">w = <span class="s8">Window</span>.new.front;</p>
<p class="p13">w.view.background_(<span class="s8">Color</span>.white);</p>
<p class="p13">3.do{<span class="s8">|i|</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>v = <span class="s8">UserView</span>(w, <span class="s8">Rect</span>(20+(i*120), 100, 100, 100));</p>
<p class="p13"><span class="Apple-tab-span">	</span>v.background_(<span class="s8">Color</span>.rand);</p>
<p class="p13"><span class="Apple-tab-span">	</span>v.drawFunc = drawFunc;</p>
<p class="p13"><span class="Apple-tab-span">	</span>v.mouseDownAction = mouseDownFunc;</p>
<p class="p13"><span class="Apple-tab-span">	</span>v.mouseUpAction = mouseUpFunc;</p>
<p class="p13"><span class="Apple-tab-span">	</span>v.mouseMoveAction = mouseMoveFunc;</p>
<p class="p13"><span class="Apple-tab-span">	</span>v.relativeOrigin = <span class="s8">true</span>;</p>
<p class="p13">};</p>
<p class="p13">w.refresh;</p>
<p class="p13">)</p>
<p class="p3"><br></p>
<p class="p3"><br></p>
<p class="p3"><br></p>
<p class="p12">// Use the mouse to draw on the view</p>
<p class="p3"><br></p>
<p class="p13">(</p>
<p class="p14"><span class="s9">var</span> w, txt, tmppoints, all;</p>
<p class="p14">tmppoints = [];</p>
<p class="p15"><br></p>
<p class="p14">w = <span class="s9">Window</span>(<span class="s12">"draw on me"</span>, <span class="s9">Rect</span>(128, 64, 340, 360));</p>
<p class="p15"><br></p>
<p class="p14">v = <span class="s9">UserView</span>(w,w.view.bounds)</p>
<p class="p14"><span class="Apple-tab-span">	</span>.mouseMoveAction_({<span class="s9">|v,x,y|</span></p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>[x,y].postln;</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>tmppoints = tmppoints.add(v.mousePosition);</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>v.refresh;</p>
<p class="p14">})</p>
<p class="p14"><span class="Apple-tab-span">	</span>.mouseUpAction_({<span class="s9">|v,x,y|</span></p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>all = all.add(tmppoints.copy);</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>tmppoints = [];</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>v.refresh;</p>
<p class="p14">})</p>
<p class="p14"><span class="Apple-tab-span">	</span>.drawFunc_{<span class="s9">|me|</span></p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">Pen</span>.use {<span class="Apple-tab-span">	</span></p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">Pen</span>.fillColor = <span class="s9">Color</span>.white;</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">Pen</span>.fillRect(me.bounds.moveTo(0,0));<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">Pen</span>.width = 1;</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">Pen</span>.strokeColor = <span class="s9">Color</span>.black;</p>
<p class="p15"><br></p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">Pen</span>.beginPath;</p>
<p class="p15"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>tmppoints.do{<span class="Apple-tab-span">	</span><span class="s9">|p, i|</span></p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>if(i == 0){</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">Pen</span>.moveTo(p);</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>}{</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">Pen</span>.lineTo(p);</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>}</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>};</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>all.do{<span class="s9">|points|</span></p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>points.do{<span class="s9">|p, i|</span></p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>if(i == 0){</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">Pen</span>.moveTo(p);</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>}{</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">Pen</span>.lineTo(p);</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>}</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>};</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>};</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">Pen</span>.stroke;</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>};</p>
<p class="p14"><span class="Apple-tab-span">	</span>};<span class="Apple-tab-span">	</span></p>
<p class="p14">v.relativeOrigin = <span class="s9">true</span>;</p>
<p class="p15"><span class="Apple-tab-span">	</span></p>
<p class="p14">w.front;</p>
<p class="p13">)</p>
<p class="p3"><br></p>
<p class="p3"><br></p>
<p class="p12">// Clearing on Refresh</p>
<p class="p12">//</p>
<p class="p12">// Set the behaviour for refreshing the view.</p>
<p class="p12">// If this flag is true (the default) the view will be cleared before each refresh call,</p>
<p class="p12">// otherwise It will draw in top of it.</p>
<p class="p12">// On OSX this functionality is only available for the version &gt;= 10.4 and with the flag relativeOrigin set to true.</p>
<p class="p3"><br></p>
<p class="p13">(</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s8">var</span> width = 640, height = 480, w, theta = 0, drawFunc, gui;</p>
<p class="p13"><span class="Apple-tab-span">	</span>gui = <span class="s8">GUI</span>.get( <span class="s11">\cocoa</span> );</p>
<p class="p13"><span class="Apple-tab-span">	</span>w = gui.window.new( <span class="s12">"clearOnRefresh = true"</span>, <span class="s8">Rect</span>( 128, 64, width, height ), <span class="s8">false</span> );</p>
<p class="p13"><span class="Apple-tab-span">	</span>drawFunc = { <span class="s8">arg</span> view;</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s8">var</span> x = 20 * sin( theta ), y = 42 * cos( theta );</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>gui.pen.addRect( view.bounds.moveTo( 0, 0 ));</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>gui.pen.clip;</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>theta = theta + 0.01;</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>gui.pen.fillColor_( <span class="s8">Color</span>.red( 0.2, 0.1 ));</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>gui.pen.fillRect( <span class="s8">Rect</span>( 0, 0, width, height ));</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>gui.pen.strokeColor_( <span class="s8">Color</span>.white );</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>gui.pen.translate( width * 0.5, height * 0.5 );</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>6.do { <span class="s8">arg</span> i;</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>gui.pen.rotate( theta * (1 - (i / 6)) );</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>gui.pen.scale( 0.7 + (i * 0.4), 0.4 + (i * 0.5) );</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>gui.pen.strokeOval( <span class="s8">Rect</span>.aboutPoint( <span class="s8">Point</span>( x, y ), 60, 40 ));</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>};</p>
<p class="p13"><span class="Apple-tab-span">	</span>};</p>
<p class="p13"><span class="Apple-tab-span">	</span>x = gui.userView.new( w, <span class="s8">Rect</span>( 10, 10, width - 20, height - 20 ))</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>.canFocus_( <span class="s8">false</span> )</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>.drawFunc_( drawFunc )</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>.clearOnRefresh_( <span class="s8">false</span> )</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>.relativeOrigin_( <span class="s8">true</span> );</p>
<p class="p3"><br></p>
<p class="p13"><span class="Apple-tab-span">	</span>w.front;</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s8">Routine</span>({ while({ x.isClosed.not }, { x.refresh; (1/25).wait })}).play( <span class="s8">AppClock</span> );</p>
<p class="p13">)</p>
<p class="p3"><br></p>
<p class="p13">(</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s8">var</span> width= 640, height= 480, w, theta= 0, drawFunc;</p>
<p class="p13"><span class="Apple-tab-span">	</span>w= <span class="s8">GUI</span>.window.new(<span class="s12">"trail test3"</span>, <span class="s8">Rect</span>(128, 64, width, height), <span class="s8">false</span>);</p>
<p class="p13"><span class="Apple-tab-span">	</span>drawFunc= {<span class="s8">|v|</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s8">var</span> x= 20*sin(theta), y= 42*cos(theta);</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>theta= theta+0.01;</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s8">GUI</span>.pen.fillColor_(<span class="s8">Color</span>.red(0.2, 0.1));</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s8">GUI</span>.pen.fillRect(<span class="s8">Rect</span>(0, 0, width, height));</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s8">GUI</span>.pen.strokeColor_(<span class="s8">Color</span>.white);</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s8">GUI</span>.pen.push;</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s8">GUI</span>.pen.translate(width*0.5, height*0.5);</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>6.do{<span class="s8">|i|</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s8">GUI</span>.pen.rotate(theta*(1-(i/6)));</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s8">GUI</span>.pen.scale(0.7+(i*0.4), 0.4+(i*0.5));</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s8">GUI</span>.pen.strokeOval(<span class="s8">Rect</span>.aboutPoint(<span class="s8">Point</span>(x, y), 60, 40))</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>};</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s8">GUI</span>.pen.pop;</p>
<p class="p13"><span class="Apple-tab-span">	</span>};</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s8">GUI</span>.userView.new(w, <span class="s8">Rect</span>(10, 10, width-20, height-20)).drawFunc_(drawFunc).relativeOrigin_(<span class="s8">true</span>);</p>
<p class="p13"><span class="Apple-tab-span">	</span>w.front;</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s8">Routine</span>({<span class="s8">inf</span>.do{<span class="s8">|i|</span> w.refresh; (1/25).wait}}).play(<span class="s8">AppClock</span>);</p>
<p class="p13">)</p>
<p class="p3"><br></p>
<p class="p3"><br></p>
<p class="p12">// Prevent redrawing:</p>
<p class="p3"><br></p>
<p class="p13">(</p>
<p class="p13"><span class="s8">var</span> func, views;</p>
<p class="p3"><br></p>
<p class="p13">func = {<span class="s8">|me|</span></p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="s8">Pen</span>.use{</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>10.do{</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Pen.color = <span class="s8">Color</span>.red(rrand(0.0, 1), rrand(0.0, 0.5));</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s8">Pen</span>.addArc((400.exprand(2))@(100.rand), rrand(10, 100), 2pi.rand, pi);</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s8">Pen</span>.perform([<span class="s11">\stroke</span>, <span class="s11">\fill</span>].choose);</p>
<p class="p13"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>}</p>
<p class="p13"><span class="Apple-tab-span">	</span>}</p>
<p class="p13">};</p>
<p class="p3"><br></p>
<p class="p17"><span class="s3">w = </span><span class="s8">Window</span><span class="s3">.new(</span>"DrawFunc Examples"<span class="s3">).front;</span></p>
<p class="p13">w.view.background_(<span class="s8">Color</span>.white);</p>
<p class="p13">views = {<span class="s8">|i|</span></p>
<p class="p13"><span class="Apple-tab-span">	</span>v = <span class="s8">UserView</span>(w, <span class="s8">Rect</span>(20+(i*120), 100, 100, 100)).relativeOrigin_(<span class="s8">true</span>);</p>
<p class="p13"><span class="Apple-tab-span">	</span>v.drawFunc = func;</p>
<p class="p13">} ! 3;</p>
<p class="p13">w.refresh;</p>
<p class="p13">{views.do{<span class="s8">|v|</span> v.clearOnRefresh_(<span class="s8">false</span>);v.drawFunc = <span class="s8">nil</span>}}.defer(0.4);</p>
<p class="p13">)</p>
<p class="p3"><br></p>
<p class="p3"><br></p>
<p class="p12">// Use refreshInRect(aRect).</p>
<p class="p12">// Constrains the receiver's refresh area to the rectangle passed in aRect.</p>
<p class="p12">// you may use Quartz Debug's flash screen updates to see the refresh area of the view</p>
<p class="p3"><br></p>
<p class="p13">(</p>
<p class="p14"><span class="s9">var</span> userView, win, blob = <span class="s9">Rect</span>(0, 0, 50, 50), trackblob=<span class="s9">false</span>, pmouse;</p>
<p class="p15"><br></p>
<p class="p17"><span class="s3">a = </span><span class="s9">Image</span><span class="s3">.new(</span>"/Library/Desktop Pictures/Ripples Blue.jpg"<span class="s3">);</span></p>
<p class="p15"><br></p>
<p class="p14">win = <span class="s9">Window</span>.new(<span class="s12">"refreshInRect Test"</span>, <span class="s9">Rect</span>(400, 400, 600, 200), scroll:<span class="s9">true</span>).front;</p>
<p class="p14">win.onClose_({ a.free; });</p>
<p class="p15"><br></p>
<p class="p14">userView = <span class="s9">UserView</span>(win, <span class="s9">Rect</span>(10,10,2000,800))</p>
<p class="p14"><span class="Apple-tab-span">	</span>.backgroundImage_(a, 5)</p>
<p class="p14"><span class="Apple-tab-span">	</span>.relativeOrigin_(<span class="s9">false</span>)</p>
<p class="p14"><span class="Apple-tab-span">	</span>.drawFunc_({<span class="s9">|me|</span></p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">Pen</span>.fillColor = <span class="s9">Color</span>.blue;</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">Pen</span>.fillRect(blob);</p>
<p class="p14"><span class="Apple-tab-span">	</span>})</p>
<p class="p14"><span class="Apple-tab-span">	</span>.mouseDownAction_({<span class="s9">|v, x, y, mod|</span></p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>pmouse = x@y;</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>trackblob = blob.containsPoint(pmouse);</p>
<p class="p14"><span class="Apple-tab-span">	</span>})</p>
<p class="p14"><span class="Apple-tab-span">	</span>.mouseUpAction_({<span class="s9">|v, x, y, mod|</span></p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>trackblob = <span class="s9">false</span>;</p>
<p class="p14"><span class="Apple-tab-span">	</span>})</p>
<p class="p14"><span class="Apple-tab-span">	</span>.mouseMoveAction_({<span class="s9">|v, x, y, mod|</span></p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s9">var</span> refresh, mouse, delta;</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>mouse = x@y;</p>
<p class="p15"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>if(trackblob, {</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>refresh = blob.copy;</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>delta = mouse-pmouse;</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>blob = blob.moveBy(delta.x, delta.y);</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>refresh = refresh.union(blob);</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>v.refreshInRect(refresh);</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>});</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>pmouse = mouse;</p>
<p class="p14"><span class="Apple-tab-span">	</span>});</p>
<p class="p15"><br></p>
<p class="p14">blob = blob.moveBy(userView.bounds.left, userView.bounds.top);</p>
<p class="p14">userView.bounds.postln;</p>
<p class="p13">)</p>
<p class="p3"><br></p>
</body>
</html>
